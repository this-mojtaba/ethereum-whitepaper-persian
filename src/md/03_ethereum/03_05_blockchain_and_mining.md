# بلاکچین و استخراج

(Blockchain and Mining)

بلاکچین اتریوم از بسیاری جهات به بلاکچین بیت‌کوین شباهت دارد، هرچند تفاوت‌هایی نیز میان آن‌ها وجود دارد. مهم‌ترین تفاوت میان اتریوم و بیت‌کوین از نظر معماری بلاکچین این است که، برخلاف بیت‌کوین، بلاک‌های اتریوم علاوه بر فهرست تراکنش‌ها، شامل نسخه‌ای از جدیدترین وضعیت شبکه نیز هستند. افزون بر این، دو مقدار دیگر یعنی شمارهٔ بلاک و درجهٔ سختی (Difficulty) نیز در هر بلاک ذخیره می‌شوند.

الگوریتم اعتبارسنجی بلاک در اتریوم به‌صورت زیر است:

1. بررسی می‌شود که بلاک قبلی‌ای که به آن ارجاع داده شده وجود داشته و معتبر باشد.
2. بررسی می‌شود که برچسب زمانی بلاک از برچسب زمانی بلاک قبلی بزرگ‌تر بوده و بیش از ۱۵ دقیقه جلوتر از زمان فعلی نباشد.
3. بررسی می‌شود که شمارهٔ بلاک، درجهٔ سختی، ریشهٔ تراکنش‌ها (Transaction Root)، ریشهٔ بلاک‌های عمو (Uncle Root) و محدودیت گاز (Gas Limit) — که همگی مفاهیم سطح پایین مخصوص اتریوم هستند — معتبر باشند.
4. بررسی می‌شود که اثبات کار (Proof of Work) بلاک معتبر باشد.
5. مقدار `S[0]` برابر با ریشهٔ وضعیت (STATE_ROOT) بلاک قبلی در نظر گرفته می‌شود.
6. فرض می‌کنیم `TX` فهرست تراکنش‌های بلاک با `n` تراکنش باشد. برای تمام `i` در بازهٔ 0 تا `n-1`، مقدار `S[i+1]` برابر با `APPLY(S[i], TX[i])` قرار داده می‌شود. اگر اجرای هر مرحله با خطا مواجه شود، یا مجموع گاز مصرف‌شده در بلاک تا این نقطه از `GASLIMIT` فراتر رود، بلاک نامعتبر تلقی می‌شود.
7. مقدار `S_FINAL` برابر با `S[n]` در نظر گرفته می‌شود، با این تفاوت که پاداش بلاک پرداخت‌شده به استخراج‌کننده نیز به آن افزوده می‌شود.
8. بررسی می‌شود که آیا `S_FINAL` با `STATE_ROOT` ذخیره‌شده در بلاک یکسان است یا خیر. اگر یکسان باشد، بلاک معتبر است؛ در غیر این صورت، نامعتبر خواهد بود.

در نگاه نخست، این رویکرد ممکن است بسیار ناکارآمد به نظر برسد، چرا که مستلزم ذخیرهٔ کل وضعیت شبکه در هر بلاک است. اما در عمل، کارایی آن قابل‌مقایسه با بیت‌کوین است. دلیل این امر آن است که وضعیت شبکه در قالب یک ساختار درختی ذخیره می‌شود و پس از هر بلاک، تنها بخش کوچکی از این درخت نیاز به تغییر دارد. بنابراین، در حالت کلی، میان دو بلاک متوالی، بخش عمده‌ای از درخت بدون تغییر باقی می‌ماند و داده‌ها می‌توانند تنها یک‌بار ذخیره شده و با استفاده از اشاره‌گرها — یعنی هش زیردرخت‌ها — چندین‌بار مورد ارجاع قرار گیرند.

برای پیاده‌سازی این سازوکار، از نوع خاصی از درخت به نام «درخت پاتریشیا» (Patricia Tree) استفاده می‌شود؛ ساختاری که با اصلاح مفهوم درخت مرکل، امکان درج و حذف گره‌ها — و نه فقط تغییر آن‌ها — را به‌صورت کارآمد فراهم می‌کند. افزون بر این، از آنجا که تمام اطلاعات وضعیت شبکه در آخرین بلاک موجود است، نیازی به ذخیرهٔ کل تاریخچهٔ بلاکچین وجود ندارد؛ راهبردی که اگر در بیت‌کوین قابل استفاده بود، می‌توانست صرفه‌جویی فضایی در حدود ۵ تا ۲۰ برابر ایجاد کند.
