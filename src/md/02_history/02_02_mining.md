# استخراج (Mining)

اگر به یک سرویس متمرکز و قابل اعتماد دسترسی داشتیم، پیاده‌سازی این سیستم بسیار ساده بود؛ چرا که می‌شد آن را دقیقاً مطابق توضیحات ارائه‌شده کدنویسی کرد. اما در بیت‌کوین، هدف ساخت یک سیستم پولی غیرمتمرکز است؛ بنابراین لازم است سیستم انتقال وضعیت با یک سیستم اجماع ترکیب شود تا اطمینان حاصل شود که همهٔ شرکت‌کنندگان بر سر ترتیب تراکنش‌ها به توافق می‌رسند.

فرآیند اجماع غیرمتمرکز بیت‌کوین مستلزم آن است که گره‌های شبکه به‌طور مداوم تلاش کنند بسته‌هایی از تراکنش‌ها را تولید کنند که «بلاک» نامیده می‌شوند. شبکه به‌گونه‌ای طراحی شده است که به‌طور متوسط هر ده دقیقه یک بلاک تولید شود. هر بلاک شامل یک برچسب زمانی، یک نانس، یک ارجاع به بلاک قبلی — که در عمل همان هش بلاک پیشین است — و فهرستی از تمام تراکنش‌هایی است که از زمان بلاک قبلی انجام شده‌اند.

با گذشت زمان، این ساختار یک بلاکچین پایدار و همواره در حال رشد ایجاد می‌کند که به‌طور مداوم برای نمایش آخرین وضعیت دفترکل بیت‌کوین به‌روزرسانی می‌شود.

الگوریتم بررسی معتبر بودن یک بلاک، در این چارچوب، به‌صورت زیر تعریف می‌شود:

1. بررسی شود که بلاک قبلی‌ای که بلاک فعلی به آن ارجاع می‌دهد وجود داشته و معتبر باشد.
2. بررسی شود که برچسب زمانی بلاک از برچسب زمانی بلاک قبلی بزرگ‌تر بوده و بیش از دو ساعت جلوتر از زمان فعلی نباشد.
3. بررسی شود که اثبات کار بلاک معتبر باشد.
4. فرض می‌کنیم S[0] وضعیت شبکه در انتهای بلاک قبلی باشد.
5. فرض کنید TX فهرست تراکنش‌های بلاک با n تراکنش باشد. برای تمام i در بازهٔ 0 تا n-1، مقدار S[i+1] را برابر با APPLY(S[i], TX[i]) قرار می‌دهیم. اگر اجرای هرکدام از این مراحل با خطا مواجه شود، بلاک نامعتبر تلقی می‌شود.
6. در صورت موفقیت تمام مراحل، وضعیت نهایی S[n] به‌عنوان وضعیت شبکه در انتهای این بلاک ثبت می‌شود.

در اصل، هر تراکنش موجود در بلاک باید یک انتقال وضعیت معتبر ارائه دهد. وضعیت شبکه در خود بلاک ذخیره نمی‌شود و تنها با شروع از وضعیت اولیه و اعمال متوالی تمام تراکنش‌ها قابل محاسبه است.

همچنین ترتیب تراکنش‌ها در بلاک اهمیت دارد؛ اگر تراکنشی بخواهد خروجی ایجادشده توسط تراکنش دیگری را خرج کند، باید پس از آن در بلاک قرار گیرد.

بخش مهم الگوریتم اعتبارسنجی بلاک، اثبات کار است. شرط اصلی این است که هش SHA256 بلاک، به‌عنوان یک عدد ۲۵۶ بیتی، کمتر از یک مقدار هدف پویا باشد. این سازوکار باعث می‌شود تولید بلاک از نظر محاسباتی دشوار شود و بازنویسی زنجیره توسط مهاجمان ممکن نباشد.

از آنجا که SHA256 یک تابع شبه‌تصادفی غیرقابل‌پیش‌بینی است، تولید بلاک معتبر تنها از طریق آزمون و خطا امکان‌پذیر است. مقدار هدف به‌صورت دوره‌ای هر ۲۰۱۶ بلاک تنظیم می‌شود تا به‌طور متوسط هر ده دقیقه یک بلاک جدید تولید شود.

برای جبران این تلاش محاسباتی، استخراج‌کنندهٔ هر بلاک پاداشی برابر با ۲۵ بیت‌کوین دریافت می‌کند. همچنین کارمزد تراکنش‌ها نیز به استخراج‌کننده تعلق می‌گیرد. این تنها روش صدور بیت‌کوین‌های جدید است؛ چرا که وضعیت اولیه شبکه هیچ سکه‌ای نداشت.

برای درک بهتر هدف استخراج، بررسی می‌کنیم در صورت حضور یک مهاجم مخرب چه اتفاقی رخ می‌دهد. از آنجا که رمزنگاری زیربنایی بیت‌کوین امن در نظر گرفته می‌شود، مهاجم بخشی از سیستم بیت‌کوین را هدف قرار می‌دهد که به‌طور مستقیم توسط رمزنگاری محافظت نمی‌شود: ترتیب تراکنش‌ها.

راهبرد مهاجم ساده است:

1. ارسال ۱۰۰ بیت‌کوین به یک فروشنده در ازای دریافت یک کالا (ترجیحاً یک کالای دیجیتال با تحویل سریع)
2. انتظار برای دریافت کالا
3. ایجاد یک تراکنش دیگر که همان ۱۰۰ بیت‌کوین را به خود مهاجم ارسال می‌کند
4. تلاش برای قانع‌کردن شبکه به این‌که تراکنش دوم زودتر انجام شده است

پس از انجام گام نخست، یکی از استخراج‌کنندگان تراکنش را در بلاک شمارهٔ ۲۷۰۰۰۰ قرار می‌دهد. حدود یک ساعت بعد، پنج بلاک دیگر به زنجیره افزوده می‌شوند که به‌صورت غیرمستقیم تراکنش را تأیید می‌کنند. در این مرحله، فروشنده پرداخت را نهایی تلقی کرده و کالا را تحویل می‌دهد.

اکنون مهاجم تراکنش دیگری ایجاد می‌کند که همان ۱۰۰ بیت‌کوین را به خودش ارسال می‌کند. این تراکنش به‌طور عادی پردازش نمی‌شود، زیرا تلاش می‌کند یک UTXO خرج‌شده را دوباره مصرف کند.

در نتیجه، مهاجم یک انشعاب از بلاکچین ایجاد می‌کند و نسخهٔ متفاوتی از بلاک ۲۷۰۰۰۰ را استخراج می‌کند. به دلیل تفاوت داده‌ها، انجام دوبارهٔ اثبات کار لازم است و زنجیرهٔ جدید از زنجیرهٔ اصلی جدا می‌شود.

طبق قاعدهٔ اجماع، طولانی‌ترین زنجیره به‌عنوان زنجیرهٔ معتبر پذیرفته می‌شود. استخراج‌کنندگان معتبر روی زنجیرهٔ اصلی کار می‌کنند و مهاجم به‌تنهایی روی زنجیرهٔ خود باقی می‌ماند. برای موفقیت مهاجم، لازم است توان محاسباتی‌ای بیش از کل شبکه داشته باشد؛ وضعیتی که به حملهٔ ۵۱٪ معروف است.
